<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>I want it! - Trumpet</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "I want it!";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Trumpet</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">What is Trumpet</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../architecture/">How it works</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="./">I want it!</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#project-structure">Project structure</a></li>
                
            
                <li class="toctree-l3"><a href="#build-it">Build it</a></li>
                
                    <li><a class="toctree-l4" href="#rpm">RPM</a></li>
                
                    <li><a class="toctree-l4" href="#compatibility">Compatibility</a></li>
                
            
                <li class="toctree-l3"><a href="#run-it">Run it</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../applications/">Write your Apps</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../operations/">For DevOps</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../changelog/">Changelog</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../license/">License</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Trumpet</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>I want it!</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="project-structure">Project structure</h1>
<p>The current project is composed of 4 sub-projects:</p>
<ol>
<li>
<p><a href="../../common"><code>common</code></a><br />
  The <code>common</code> sub-project is where the reusable code is shared across the projects.</p>
</li>
<li>
<p><a href="../../server"><code>server</code></a><br />
  Trumpet server, i.e. reading the hdfs edits log files. Build this project to <a href="#Build_it">deploy and run Trumpet</a></p>
</li>
<li>
<p><a href="../../client"><code>client</code></a><br />
  Example of client application, reading from Kakfa and doing someting meaningful. This sub-project also
  contains the required dependencies to write <a href="../applications/">client applications</a>.</p>
</li>
<li>
<p><a href="../../docs"><code>docs</code></a><br />
  This documentation.</p>
</li>
</ol>
<h1 id="build-it">Build it</h1>
<p>This project is based on <a href="http://maven.apache.org">Maven</a>. To build it, you need to ensure 
you have java and maven installed, and then: </p>
<pre><code class="bash">mvn clean install
</code></pre>

<p>Available options, in addition to the standard maven options:</p>
<ul>
<li><code>-Phadoop26</code> (default), <code>-Phadoop27</code>, <code>-Pcdh52</code>, <code>-Pcdh53</code>, <code>-Pcdh54</code> or <code>-Phdp22</code>. See <a href="#Compatibility">Compatibility</a> for details.</li>
<li><code>-DrpmRelease=1</code> to change the RPM build release number. See <a href="#RPM">RPM</a> for details.</li>
</ul>
<h2 id="rpm">RPM</h2>
<p>Running <code>mvn package</code> (included in the <code>install</code> goal) will generate an RPM. <code>find server/target -name "*.rpm"</code> to list 
the exact path and name of the server RPM.</p>
<p>The RPM can be transformed in .deb via Alien or FPM (see <a href="https://www.howtoforge.com/converting_rpm_to_deb_with_alien">https://www.howtoforge.com/converting_rpm_to_deb_with_alien</a> 
or <a href="https://github.com/jordansissel/fpm">https://github.com/jordansissel/fpm</a> for more generic conversion) if required.</p>
<p>The RPM is installing Trumpet under <code>/opt/trumpet/server/</code>, with the following directory structure:</p>
<pre><code class="bash">/opt/trumpet/server/
  +- bin/
  |  +- events-validator.sh
  |  +- peek-events.sh
  |  +- status.sh
  |  -- trumpet.sh
  +- conf/
  |  -- logback-production.xml
  +- lib/
  |  +- server-&lt;VERSION&gt;.jar
  |  +- server.jar -&gt; server-&lt;VERSION&gt;.jar
  |  -- ... all the other jars ...
  -- logs/
     +- trumpet.log
     +- stdout
     -- stderr
</code></pre>

<p>While building Trumpet, you can add <code>-DrpmRelease=123</code> as a maven command parameter to change the RPM build number (by default <em>1</em>)</p>
<p>Note: if you just want to build a specific version of the server RPM, without rebuilding everything, you need to run the following:</p>
<pre><code class="bash">mvn build-helper:parse-version rpm:attached-rpm -Phadoop27 -DrpmRelease=123 -f server
</code></pre>

<h2 id="compatibility">Compatibility</h2>
<p><a href="https://issues.apache.org/jira/browse/HDFS-7446">HDFS-7446</a>, released as part of 
<a href="https://github.com/aw-altiscale/eco-release-metadata/blob/master/HADOOP/2.7.0/RELEASENOTES.2.7.0.md">Hadoop 2.7.0 release</a>, 
changed the HDFS-Inotify interface. In order to achieve multi-version compatibility, Trumpet is using a 
<a href="https://github.com/verisign/trumpet/tree/master/server/src/main/java/org/apache/hadoop/hdfs/inotify/InotifyCompat.java">compatibility class</a> 
which uses reflection to work around compatibility issues.</p>
<p>Trumpet is tested with:</p>
<ul>
<li>Hadoop 2.6 -- <code>mvn clean install -Phadoop26</code> (default)</li>
<li>Hadoop 2.7 -- <code>mvn clean install -Phadoop27</code></li>
<li>CDH 5 -- <code>mvn clean install -Pcdh52</code>, <code>mvn clean install -Pcdh53</code> or <code>mvn clean install -Pcdh54</code></li>
<li>HDP 2.2, 2.3 -- <code>mvn clean install -Phdp22</code>, <code>mvn clean install -Phdp23</code></li>
</ul>
<h1 id="run-it">Run it</h1>
<p>Trumpet server is a long running process to run alongside the JournalNode. A <a href="http://www.supervisord.org">supervisord</a> 
<a href="https://github.com/verisign/trumpet/tree/master/server/src/main/config/trumpet-server.ini">config file</a> is also provided if you'd like to use supervisord daemon to launch Trumpet.</p>
<p>Once the RPM (or equivalent) is installed, manually launch Trumpet like this:</p>
<pre><code class="bash">$ /opt/trumpet/server/bin/trumpet.sh --zk.connect &lt;zk_ip:2181&gt;
</code></pre>

<p>Note: If you're running CDH, it's highly likely that <code>dfs.journalnode.name.dir</code> is not in <code>/etc/hadoop/conf/hdfs-site.xml</code>. 
You need to manually set <code>--dfs.edits.dir</code> parameters to specify manually the directory:</p>
<pre><code class="bash">$ /opt/trumpet/server/bin/trumpet.sh --zk.connect &lt;zk_ip:2181&gt; --dfs.edits.dir &lt;root_dir_where_edits_files_are_stored&gt;
</code></pre>

<p>Note #2: <code>&lt;root_dir_where_edits_files_are_stored&gt;</code> should point to the same location than <code>dfs.journalnode.name.dir</code>, 
i.e. excluding <code>&lt;nameservice&gt;/current</code>.</p>
<p>Or copy <code>/opt/trumpet/server/conf/trumpet-server.ini</code> in <code>/etc/supervisord.d</code> to have have Trumpet 
run as a supervisord process (recommended).</p>
<pre><code class="bash">sudo cp /opt/trumpet/server/config/trumpet-server.ini /etc/supervisord.d/
sudo vi /etc/supervisord.d/trumpet-server.ini # update &lt;zk_ip:2181&gt; and potentially add --dfs.edits.dir if not found in /etc/hadood/conf/hdfs-site.xml
sudo supervisorctl reread
sudo supervisorctl add trumpet # will start Trumpet as autostart is turned on
</code></pre>

<p>Note #3: all the scripts can be run with <code>--help</code> to get additional info</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../applications/" class="btn btn-neutral float-right" title="Write your Apps"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../architecture/" class="btn btn-neutral" title="How it works"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../architecture/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../applications/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
