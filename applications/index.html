<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Write your Apps - Trumpet</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Write your Apps";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Trumpet</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">What is Trumpet</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../architecture/">How it works</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../installation/">I want it!</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="./">Write your Apps</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#dependency">Dependency</a></li>
                
            
                <li class="toctree-l3"><a href="#use-it">Use it</a></li>
                
            
                <li class="toctree-l3"><a href="#events-format">Events Format</a></li>
                
            
                <li class="toctree-l3"><a href="#example-application">Example Application</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../operations/">For DevOps</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../changelog/">Changelog</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../license/">License</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Trumpet</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Write your Apps</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>Trumpet comes out as a new building block in the Hadoop ecosystem 
and unleashes brand new capabilities to HDFS. As it relies mostly on Kafka 
for the distribution of the events to the clients, it is decoupled from the NameNode
and does not impact its operations. It also scales as well as your Kafka cluster.</p>
<p>Below are the steps to let you simply and quickly write your own client applications:</p>
<h2 id="dependency">Dependency</h2>
<p>Add the dependency to the Trumpet client in your project</p>
<pre><code class="xml">        &lt;dependency&gt;
            &lt;groupId&gt;com.verisign.vscc.trumpet&lt;/groupId&gt;
            &lt;artifactId&gt;trumpet-client&lt;/artifactId&gt;
            &lt;version&gt;${trumpet.version}&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre>

<p>Hint: the versions follow carefully the tags naming convention. Looks at the available tags in the project to get the version.</p>
<h2 id="use-it">Use it</h2>
<p>Now it's as easy as using a Java <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Iterable.html">Iterable</a>.</p>
<pre><code class="java">String kafkaTopic = ...
String zkConnect = ...
for (Map&lt;String, Object&gt; event : new TrumpetEventStreamer(curatorFramework, kafkaTopic)) {
    ... do something with your event!
}
</code></pre>

<p>TODO: TESTING</p>
<h2 id="events-format">Events Format</h2>
<p>The events published into Kakfa are JSON dictionary. The rationale behind that is discussed <a href="../architecture/#events-as-json-dictionary">here</a>.</p>
<p>Events taken into account are basically all events modifying the NameNode <a href="">org.apache.hadoop.hdfs.server.namenode.INodeDirectory</a> in-memory structure. 
The exhaustive list is given below, and they are regrouped in 6 event types: <code>CREATE</code>, <code>CLOSE</code>, <code>APPEND</code>, <code>RENAME</code>, <code>METADATA</code>, <code>UNLINK</code>:</p>
<ul>
<li>Add -- either <code>CREATE</code> or <code>APPEND</code></li>
<li>Close -- <code>CLOSE</code></li>
<li>Set Replication -- <code>METADATA</code></li>
<li>ConcatDelete -- create a sequence of <code>APPEND</code>, <code>UNLINK</code> and <code>CLOSE</code>, but all with the same <code>txId</code></li>
<li>RenameOld -- <code>RENAME</code></li>
<li>Rename -- <code>RENAME</code></li>
<li>Delete -- <code>UNLINK</code></li>
<li>Mkdir -- <code>CREATE</code></li>
<li>SetPermissions -- <code>METADATA</code></li>
<li>SetOwner -- <code>METADATA</code></li>
<li>Times -- <code>METADATA</code></li>
<li>Symlink -- <code>CREATE</code></li>
<li>RemoveXAttr -- <code>METADATA</code></li>
<li>SetXAttr -- <code>METADATA</code></li>
<li>SetAcl -- <code>METADATA</code></li>
</ul>
<p>Find more details about the operation decoding and translation in the class <a href="">org.apache.hadoop.hdfs.server.namenode.InotifyFSEditLogOpTranslator</a> 
and <a href="">org.apache.hadoop.hdfs.inotify.Event</a>.</p>
<p>The available attributes in the JSON dict per event types are described below.</p>
<ul>
<li><code>APPEND</code></li>
</ul>
<table>
<thead>
<tr>
<th>Attribute name</th>
<th align="center">Mandatory</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>txId</td>
<td align="center">Yes</td>
<td>transaction Id</td>
</tr>
<tr>
<td>eventType</td>
<td align="center">APPEND</td>
<td>type of event.</td>
</tr>
<tr>
<td>path</td>
<td align="center"></td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li><code>CLOSE</code></li>
</ul>
<table>
<thead>
<tr>
<th>Attribute name</th>
<th align="center">Mandatory</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>txId</td>
<td align="center">Yes</td>
<td>transaction Id</td>
</tr>
<tr>
<td>eventType</td>
<td align="center">CLOSE</td>
<td>type of event.</td>
</tr>
<tr>
<td>path</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>fileSize</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>timestamp</td>
<td align="center"></td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li><code>CREATE</code></li>
</ul>
<table>
<thead>
<tr>
<th>Attribute name</th>
<th align="center">Mandatory</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>txId</td>
<td align="center">Yes</td>
<td>transaction Id</td>
</tr>
<tr>
<td>eventType</td>
<td align="center">CREATE</td>
<td>type of event.</td>
</tr>
<tr>
<td>iNodeType</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>path</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>ctime</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>replication</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>ownerName</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>groupName</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>perms</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>symlinkTarget</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>overwrite</td>
<td align="center"></td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li><code>METADATA</code></li>
</ul>
<table>
<thead>
<tr>
<th>Attribute name</th>
<th align="center">Mandatory</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>txId</td>
<td align="center">Yes</td>
<td>transaction Id</td>
</tr>
<tr>
<td>eventType</td>
<td align="center">METADATA</td>
<td>type of event.</td>
</tr>
<tr>
<td>path</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>metadataType</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>mtime</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>atime</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>replication</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>ownerName</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>groupName</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>perms</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>acls</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>xAttrs</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>xAttrsRemoved</td>
<td align="center"></td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li><code>RENAME</code></li>
</ul>
<table>
<thead>
<tr>
<th>Attribute name</th>
<th align="center">Mandatory</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>txId</td>
<td align="center">Yes</td>
<td>transaction Id</td>
</tr>
<tr>
<td>eventType</td>
<td align="center">RENAME</td>
<td>type of event.</td>
</tr>
<tr>
<td>srcPath</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>dstPath</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>timestamp</td>
<td align="center"></td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li><code>UNLINK</code></li>
</ul>
<table>
<thead>
<tr>
<th>Attribute name</th>
<th align="center">Mandatory</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>txId</td>
<td align="center">Yes</td>
<td>transaction Id</td>
</tr>
<tr>
<td>eventType</td>
<td align="center">UNLINK</td>
<td>type of event.</td>
</tr>
<tr>
<td>path</td>
<td align="center"></td>
<td></td>
</tr>
<tr>
<td>timestamp</td>
<td align="center"></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="example-application">Example Application</h2>
<p><code>com.verisign.vscc.hdfs.trumpet.client.example.TestApp</code> is a sample application, listening to Trumpet and filtering out 
<code>_SUCCESS</code> files, indicating the success of a MapReduce application.</p>
<p>It would be really easy to start a distcp job from here to, for instance, replicate the newly created data into a different remote cluster.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../operations/" class="btn btn-neutral float-right" title="For DevOps"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../installation/" class="btn btn-neutral" title="I want it!"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../installation/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../operations/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
